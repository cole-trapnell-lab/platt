% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/deg.R
\name{compare_gene_expression_within_node}
\alias{compare_gene_expression_within_node}
\title{Compare Gene Expression Within Node}
\usage{
compare_gene_expression_within_node(
  cell_group,
  ccs,
  pb_cds,
  control_ids,
  perturbation_ids,
  ambient_estimate_matrix = NULL,
  ambient_stderr_matrix = NULL,
  nuisance_model_formula_str = "0",
  state_term = "cell_group",
  log_fc_thresh = 1,
  abs_expr_thresh = 1e-10,
  sig_thresh = 0.05,
  min_cells_per_pseudobulk = NULL,
  exclude_results_below_ambient = TRUE,
  expected_effect_mode_interval = c(-10, 10),
  write_dir = NULL,
  cores = 1,
  max_simultaneous_genes = NULL
)
}
\arguments{
\item{cell_group}{Character. The cell group to analyze.}

\item{ccs}{Data frame or matrix. Cell cycle scores.}

\item{pb_cds}{CellDataSet. The pseudobulk cell dataset.}

\item{control_ids}{Character vector. IDs of control samples.}

\item{perturbation_ids}{Character vector. IDs of perturbation samples.}

\item{ambient_estimate_matrix}{Matrix. Ambient RNA estimate matrix.}

\item{ambient_stderr_matrix}{Matrix. Ambient RNA standard error matrix.}

\item{nuisance_model_formula_str}{Character. Formula string for nuisance model.}

\item{state_term}{Character. The term in colData to use for state.}

\item{log_fc_thresh}{Numeric. Log fold change threshold.}

\item{abs_expr_thresh}{Numeric. Absolute expression threshold.}

\item{sig_thresh}{Numeric. Significance threshold.}

\item{min_cells_per_pseudobulk}{Integer. Minimum cells per pseudobulk.}

\item{exclude_results_below_ambient}{Logical. Whether to exclude results below ambient RNA levels.}

\item{expected_effect_mode_interval}{Numeric vector. Interval for expected effect mode.}

\item{write_dir}{Character. Directory to write output files.}

\item{cores}{Integer. Number of cores to use for parallel processing.}

\item{max_simultaneous_genes}{Integer. Maximum number of genes to process simultaneously.}
}
\value{
A data frame with perturbation effects, or NULL if write_dir is specified.
}
\description{
This function compares gene expression within a specified cell group,
fitting models per cell group and computing contrasts for perturbations
against controls. It can also compare perturbations to ambient RNA levels
if provided.
}
\examples{
compare_gene_expression_within_node(
  cell_group = "group1",
  ccs = ccs_data,
  pb_cds = pb_cds_data,
  control_ids = c("ctrl1", "ctrl2"),
  perturbation_ids = c("pert1", "pert2"),
  write_dir = "output"
)

}
